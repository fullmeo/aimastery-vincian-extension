# ğŸš€ v8.0 Development Setup Guide

**Date**: November 3, 2025
**Phase**: Setup Week (Week 0 of 16)
**Status**: Ready to Start
**Current Stable**: v7.2.1 (Production)

---

## ğŸ¯ Objectif de Cette Semaine

PrÃ©parer l'environnement de dÃ©veloppement pour commencer v8.0 lundi prochain.

**DurÃ©e**: 3-5 heures rÃ©parties sur la semaine
**Ã‰quipe**: Vous + moi (assistance architecture)

---

## ğŸ“‹ Checklist de Setup (Cette Semaine)

### Day 1: Git & Branches (30 min)

- [ ] **CrÃ©er branche v8.0-dev**
  ```bash
  cd aimastery-vincian-analysis
  git checkout -b v8.0-dev
  git push -u origin v8.0-dev
  ```

- [ ] **CrÃ©er branche main/stable pour v7.x**
  ```bash
  git checkout main
  git branch v7-stable
  git push origin v7-stable
  ```

- [ ] **StratÃ©gie de branches**:
  ```
  main (v7.2.1 stable)
    â”œâ”€ v7-stable (hotfixes v7.x)
    â””â”€ v8.0-dev (dÃ©veloppement v8.0)
        â”œâ”€ feature/worker-pool
        â”œâ”€ feature/di-container
        â””â”€ feature/ai-assistant
  ```

---

### Day 2: Structure de RÃ©pertoires (1 hour)

- [ ] **CrÃ©er structure v8.0**
  ```bash
  cd aimastery-vincian-analysis

  # Core infrastructure
  mkdir -p src/core/di
  mkdir -p src/core/features
  mkdir -p src/core/workers
  mkdir -p src/core/events

  # Feature modules
  mkdir -p src/features/code-analysis
  mkdir -p src/features/vincian-analysis
  mkdir -p src/features/user-progression
  mkdir -p src/features/premium-features
  mkdir -p src/features/ai-assistant
  mkdir -p src/features/team-collaboration

  # Tests
  mkdir -p tests/unit
  mkdir -p tests/integration
  mkdir -p tests/performance

  # Documentation
  mkdir -p docs/architecture
  mkdir -p docs/api
  mkdir -p docs/features
  ```

- [ ] **CrÃ©er fichiers README dans chaque dossier**

---

### Day 3: Outils & DÃ©pendances (1 hour)

- [ ] **Installer outils de dev**
  ```bash
  npm install --save-dev @types/jest jest ts-jest
  npm install --save-dev eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin
  npm install --save-dev prettier
  ```

- [ ] **Configurer Jest**
  ```bash
  npx ts-jest config:init
  ```

- [ ] **CrÃ©er jest.config.js**:
  ```javascript
  module.exports = {
    preset: 'ts-jest',
    testEnvironment: 'node',
    roots: ['<rootDir>/tests'],
    testMatch: ['**/__tests__/**/*.ts', '**/?(*.)+(spec|test).ts'],
    collectCoverageFrom: [
      'src/**/*.ts',
      '!src/**/*.d.ts',
      '!src/node_modules/**'
    ],
    coverageThreshold: {
      global: {
        branches: 80,
        functions: 80,
        lines: 80,
        statements: 80
      }
    }
  };
  ```

- [ ] **CrÃ©er .eslintrc.js**:
  ```javascript
  module.exports = {
    parser: '@typescript-eslint/parser',
    extends: [
      'plugin:@typescript-eslint/recommended',
    ],
    parserOptions: {
      ecmaVersion: 2020,
      sourceType: 'module',
    },
    rules: {
      '@typescript-eslint/no-explicit-any': 'warn',
      '@typescript-eslint/explicit-function-return-type': 'off',
    },
  };
  ```

- [ ] **CrÃ©er .prettierrc**:
  ```json
  {
    "semi": true,
    "trailingComma": "es5",
    "singleQuote": true,
    "printWidth": 100,
    "tabWidth": 2
  }
  ```

---

### Day 4: Premiers Fichiers v8.0 (1.5 hours)

#### 4.1: Service Container (Base)

- [ ] **CrÃ©er `src/core/di/ServiceContainer.ts`**:
  ```typescript
  /**
   * Dependency Injection Container for v8.0
   * Replaces all Singleton patterns from v7.x
   */
  export class ServiceContainer {
    private services: Map<string, any> = new Map();
    private factories: Map<string, () => any> = new Map();

    registerSingleton<T>(key: string, instance: T): void {
      this.services.set(key, instance);
    }

    registerFactory<T>(key: string, factory: () => T): void {
      this.factories.set(key, factory);
    }

    resolve<T>(key: string): T {
      if (this.services.has(key)) {
        return this.services.get(key);
      }

      if (this.factories.has(key)) {
        const instance = this.factories.get(key)!();
        this.services.set(key, instance);
        return instance;
      }

      throw new Error(`Service not found: ${key}`);
    }

    clear(): void {
      this.services.clear();
      this.factories.clear();
    }
  }

  // Global container instance
  export const container = new ServiceContainer();
  ```

#### 4.2: Base Feature Class

- [ ] **CrÃ©er `src/core/features/BaseFeature.ts`**:
  ```typescript
  import * as vscode from 'vscode';
  import { ServiceContainer } from '../di/ServiceContainer';

  export interface IFeature {
    readonly id: string;
    readonly name: string;
    readonly description: string;
    readonly version: string;

    activate(context: vscode.ExtensionContext): Promise<void>;
    deactivate(): Promise<void>;
    isEnabled(): boolean;
  }

  export abstract class BaseFeature implements IFeature {
    protected context!: vscode.ExtensionContext;
    protected disposables: vscode.Disposable[] = [];

    abstract readonly id: string;
    abstract readonly name: string;
    abstract readonly description: string;
    abstract readonly version: string;

    constructor(protected container: ServiceContainer) {}

    async activate(context: vscode.ExtensionContext): Promise<void> {
      this.context = context;

      if (!this.isEnabled()) {
        console.log(`Feature ${this.id} is disabled`);
        return;
      }

      await this.onActivate();
      this.registerCommands();
      this.registerProviders();
    }

    async deactivate(): Promise<void> {
      await this.onDeactivate();
      this.disposables.forEach(d => d.dispose());
      this.disposables = [];
    }

    isEnabled(): boolean {
      return true; // TODO: Read from config
    }

    protected abstract onActivate(): Promise<void>;
    protected abstract onDeactivate(): Promise<void>;
    protected abstract registerCommands(): void;
    protected abstract registerProviders(): void;

    protected registerCommand(
      command: string,
      handler: (...args: any[]) => any
    ): void {
      const disposable = vscode.commands.registerCommand(command, handler);
      this.disposables.push(disposable);
      this.context.subscriptions.push(disposable);
    }
  }
  ```

#### 4.3: Premier Test

- [ ] **CrÃ©er `tests/unit/ServiceContainer.test.ts`**:
  ```typescript
  import { ServiceContainer } from '../../src/core/di/ServiceContainer';

  describe('ServiceContainer', () => {
    let container: ServiceContainer;

    beforeEach(() => {
      container = new ServiceContainer();
    });

    afterEach(() => {
      container.clear();
    });

    test('should register and resolve singleton', () => {
      const service = { name: 'test' };
      container.registerSingleton('test', service);

      const resolved = container.resolve('test');
      expect(resolved).toBe(service);
    });

    test('should register and resolve factory', () => {
      let callCount = 0;
      container.registerFactory('test', () => {
        callCount++;
        return { name: 'test' };
      });

      const resolved1 = container.resolve('test');
      const resolved2 = container.resolve('test');

      expect(callCount).toBe(1); // Factory called once
      expect(resolved1).toBe(resolved2); // Same instance
    });

    test('should throw error for unknown service', () => {
      expect(() => container.resolve('unknown')).toThrow('Service not found: unknown');
    });
  });
  ```

- [ ] **Lancer le test**:
  ```bash
  npm test
  ```

---

### Day 5: Documentation & Planning (1 hour)

- [ ] **CrÃ©er `docs/architecture/v8-overview.md`**
  - Architecture diagram (texte)
  - Module descriptions
  - Dependencies graph

- [ ] **CrÃ©er `docs/v8-week-by-week-plan.md`**
  - Week 1: DI + FeatureRegistry
  - Week 2: WorkerPool
  - Week 3: Code refactoring
  - Etc. (suivre v8.0-ROADMAP.md)

- [ ] **CrÃ©er `docs/development-guide.md`**
  - How to add new feature
  - How to write tests
  - Code standards
  - PR process

- [ ] **Mettre Ã  jour README.md**
  - Add "v8.0 in development" badge
  - Link to roadmap
  - Contributing guide

---

## ğŸ¯ Scripts NPM Ã  Ajouter

Ajoutez dans `package.json`:

```json
{
  "scripts": {
    "compile": "webpack",
    "package": "webpack --mode production --devtool hidden-source-map",
    "vscode:prepublish": "npm run package",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "lint": "eslint src --ext ts",
    "lint:fix": "eslint src --ext ts --fix",
    "format": "prettier --write \"src/**/*.ts\" \"tests/**/*.ts\"",
    "format:check": "prettier --check \"src/**/*.ts\" \"tests/**/*.ts\"",
    "clean": "rimraf out dist *.vsix"
  }
}
```

---

## ğŸ—ï¸ Structure Finale Attendue

```
aimastery-vincian-analysis/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ extension.ts (v7 - will be refactored)
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ di/
â”‚   â”‚   â”‚   â””â”€â”€ ServiceContainer.ts âœ… Week 0
â”‚   â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”‚   â”œâ”€â”€ BaseFeature.ts âœ… Week 0
â”‚   â”‚   â”‚   â””â”€â”€ FeatureRegistry.ts (Week 1)
â”‚   â”‚   â”œâ”€â”€ workers/
â”‚   â”‚   â”‚   â”œâ”€â”€ WorkerPool.ts (Week 2)
â”‚   â”‚   â”‚   â””â”€â”€ ast-parser.worker.ts (Week 2)
â”‚   â”‚   â””â”€â”€ events/
â”‚   â”‚       â””â”€â”€ EventBus.ts (Week 1)
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”œâ”€â”€ code-analysis/ (Week 3)
â”‚   â”‚   â”œâ”€â”€ ai-assistant/ (Week 7-10)
â”‚   â”‚   â””â”€â”€ team-collaboration/ (Week 11-13)
â”‚   â””â”€â”€ services/ (existing - v7)
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â””â”€â”€ ServiceContainer.test.ts âœ… Week 0
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ performance/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ architecture/
â”‚   â”œâ”€â”€ api/
â”‚   â””â”€â”€ v8-week-by-week-plan.md âœ… Week 0
â”œâ”€â”€ jest.config.js âœ… Week 0
â”œâ”€â”€ .eslintrc.js âœ… Week 0
â”œâ”€â”€ .prettierrc âœ… Week 0
â””â”€â”€ v8.0-ROADMAP.md âœ… Done!
```

---

## ğŸ“Š ProgrÃ¨s Tracking

### Week 0 (Setup Week - Cette Semaine)

| Task | Time | Status | Notes |
|------|------|--------|-------|
| Git branches | 30 min | [ ] | |
| Directory structure | 1 hour | [ ] | |
| Dev tools install | 1 hour | [ ] | |
| First files | 1.5 hours | [ ] | |
| Documentation | 1 hour | [ ] | |
| **Total** | **5 hours** | **0%** | |

### Week 1-16 (Development)

Suivre: `v8.0-ROADMAP.md`

---

## ğŸ¯ Objectifs de Sortie (End of Week 0)

Ã€ la fin de cette semaine, vous devriez avoir:

âœ… Branche v8.0-dev crÃ©Ã©e et poussÃ©e
âœ… Structure de rÃ©pertoires complÃ¨te
âœ… Outils de dev configurÃ©s (Jest, ESLint, Prettier)
âœ… ServiceContainer implÃ©mentÃ©
âœ… BaseFeature implÃ©mentÃ©
âœ… Premier test unitaire qui passe
âœ… Documentation de base crÃ©Ã©e

**CritÃ¨re de succÃ¨s**: `npm test` passe avec 1+ test âœ…

---

## ğŸš€ Lundi Prochain: Week 1 Kickoff

### Objectifs Week 1:

1. **FeatureRegistry** (2 jours)
   - CrÃ©er FeatureRegistry.ts
   - Tests unitaires
   - Documentation

2. **EventBus** (1 jour)
   - CrÃ©er EventBus.ts
   - Tests unitaires

3. **Refactor Extension.ts** (2 jours)
   - Extraire premiÃ¨re feature
   - IntÃ©grer avec FeatureRegistry
   - Tests

**Deliverable Week 1**: Extension.ts rÃ©duit de 200 lignes

---

## ğŸ’¡ Conseils pour Cette Semaine

### Do's âœ…

- Prenez votre temps avec le setup
- Testez chaque outil aprÃ¨s installation
- Commitez souvent avec des messages clairs
- Documentez vos dÃ©cisions

### Don'ts âŒ

- Ne touchez pas Ã  v7.2.1 (stable en production)
- Ne prÃ©cipitez pas le setup
- Ne sautez pas les tests
- Ne travaillez pas sur main branch

---

## ğŸ“ Support

### Questions?

- Architecture: RÃ©fÃ©rez-vous Ã  `v8.0-ROADMAP.md`
- ProblÃ¨mes techniques: Demandez-moi!
- DÃ©cisions de design: On discute ensemble

### Daily Standup (Optionnel)

Chaque jour, notez:
- âœ… Ce qui est fait
- ğŸš§ Ce qui est en cours
- ğŸš« Blockers

---

## ğŸ‰ AprÃ¨s le Setup

Une fois le setup terminÃ©, vous serez prÃªt pour:

**Week 1**: DI + FeatureRegistry
**Week 2**: WorkerPool
**Week 3**: Refactoring
**Week 4-16**: Nouvelles features!

---

## âœ… Checklist Finale

Avant de commencer Week 1, vÃ©rifiez:

- [ ] `git branch` montre v8.0-dev
- [ ] `npm test` passe
- [ ] `npm run lint` passe
- [ ] Documentation README Ã  jour
- [ ] Ã‰quipe alignÃ©e sur roadmap
- [ ] Environnement de dev fonctionnel

**Status**: [ ] READY FOR WEEK 1

---

**Bonne chance avec le setup!** ğŸš€

*v8.0 - Architecture, AI, Acceleration*
